<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daftar Peserta Lengkap - Aplikasi Sekolah</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<style>
.sidebar-link.active { background-color: #3b82f6; color: white; font-weight: 600; }
</style>
</head>
<body class="bg-gray-100 font-sans">
<div class="flex h-screen">
    <div id="sidebar-placeholder"></div>
    <main class="flex-1 overflow-y-auto p-6 md:p-10">
        <header>
            <h1 class="text-3xl font-bold text-gray-900">Daftar Peserta Lengkap</h1>
            <p class="text-gray-600 mt-1">Hanya menampilkan peserta yang sudah memenuhi semua syarat.</p>
        </header>
        <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th class="px-6 py-3">No</th>
                            <th class="px-6 py-3">Nomor Resi</th>
                            <th class="px-6 py-3">Nama Peserta</th>
                            <th class="px-6 py-3">Jenis Kelamin</th>
                            <th class="px-6 py-3">Jurusan Di inginkan</th>
                            <th class="px-6 py-3">Tempat, Tanggal Lahir</th>
                        </tr>
                    </thead>
                    <tbody id="registrationsTableBody">
                        <!-- Data pendaftaran akan di-render di sini -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>



<script src="../../assets/app.js" defer></script>
<script src="../../assets/sidebar-sub-ppdb.js" defer></script>

<script>
window.App = window.App || {};

// Main app logic
window.App.main = {
    localStorageKey: 'ppdbData',

    loadRegistrations: () => {
        const dataJson = localStorage.getItem(window.App.main.localStorageKey);
        const registrations = dataJson ? JSON.parse(dataJson) : [];
        window.App.main.renderTable(registrations);
    },

    renderTable: (registrations) => {
        const tbody = document.getElementById('registrationsTableBody');
        tbody.innerHTML = '';

        const semuaSyarat = JSON.parse(localStorage.getItem('syaratPendaftaran') || '[]');

        // Filter peserta yang sudah lengkap semua syarat
        const completedRegistrations = registrations.filter(data => {
            const requiredDocs = semuaSyarat
                .filter(s => s.isActive && s.jalur === data.jalurPendaftaran)
                .map(s => s.syarat.toLowerCase().replace(/ /g, '_'));
            const missingDocs = requiredDocs.filter(doc => !data.documents?.[doc]);
            return missingDocs.length === 0;
        });

        if (!completedRegistrations.length) {
            tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Belum ada peserta yang memenuhi semua syarat.</td></tr>`;
            return;
        }

        completedRegistrations.forEach((data, idx) => {
            const row = document.createElement('tr');
            row.className = 'bg-white border-b hover:bg-gray-50';
            const jenisKelamin = data.jenisKelamin === 'L' ? 'Laki-Laki' : data.jenisKelamin === 'P' ? 'Perempuan' : '-';
            const formattedDate = data.tanggalDaftar 
                ? new Date(data.tanggalDaftar).toLocaleDateString('id-ID', { day:'2-digit', month:'long', year:'numeric' }) 
                : '-';
            row.innerHTML = `
                <td class="px-6 py-4">${idx + 1}</td>
                <td class="px-6 py-4 font-bold text-blue-600">${data.serialNumber || '-'}</td>
                <td class="px-6 py-4">${data.namaLengkap || '-'}</td>
                <td class="px-6 py-4">${jenisKelamin}</td>
                <td class="px-6 py-4">${data.jurusan || '-'}</td>
                <td class="px-6 py-4">${data.tempatLahir || '-'}, ${data.tglLahir || '-'}</td>
            `;
            tbody.appendChild(row);
        });
    }
};

// Load table on page load
document.addEventListener('DOMContentLoaded', () => {
    window.App.main.loadRegistrations();
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Aplikasi Sekolah - Buku Tamu Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <style> .modal { transition: opacity 0.25s ease; } </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="flex h-screen">
        <aside class="w-64 bg-white shadow-md hidden md:block">
            <div class="p-6"><h2 class="text-2xl font-bold text-gray-800">App Sekolah</h2><p class="text-sm text-gray-500">Versi 1.0</p></div>
            <nav class="mt-6">
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="grid-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Dashboard</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="people-outline" class="w-5 h-5"></ion-icon><span class="mx-4">PPDB</span>
                </a>
                 <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="wallet-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Keuangan</span>
                </a>
                 <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="book-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Akademik</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="finger-print-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Absensi Guru</span>
                </a>
                 <a href="#" class="flex items-center px-6 py-3 bg-blue-500 text-white font-semibold">
                    <ion-icon name="id-card-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Buku Tamu</span>
                </a>
            </nav>
        </aside>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            <header class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Buku Tamu Digital</h1>
                    <p class="text-gray-600 mt-1">Catat dan kelola semua tamu yang berkunjung ke sekolah.</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <label for="date-filter" class="text-sm font-medium text-gray-700">Riwayat tanggal:</label>
                    <input type="date" id="date-filter" class="border rounded-lg p-2 mt-1 w-full md:w-auto">
                </div>
            </header>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                <div class="bg-white p-6 rounded-lg shadow-lg"><p class="text-gray-500">Total Kunjungan Hari Ini</p><p id="statTotal" class="text-3xl font-bold text-gray-900">0</p></div>
                <div class="bg-white p-6 rounded-lg shadow-lg"><p class="text-gray-500">Tamu Masih di Lokasi</p><p id="statCurrent" class="text-3xl font-bold text-blue-600">0</p></div>
            </div>

            <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Daftar Tamu</h3>
                    <button id="addGuestBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg flex items-center">
                        <ion-icon name="add-outline" class="mr-2"></ion-icon> Tambah Tamu
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th class="px-6 py-3">Waktu Masuk</th>
                                <th class="px-6 py-3">Nama Tamu</th>
                                <th class="px-6 py-3">Bertemu Dengan</th>
                                <th class="px-6 py-3">Tujuan</th>
                                <th class="px-6 py-3">Waktu Keluar</th>
                                <th class="px-6 py-3">Status</th>
                                <th class="px-6 py-3 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="guestTableBody"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <div id="addGuestModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <form id="addGuestForm" class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 space-y-4">
            <h3 class="text-xl font-bold mb-4">Formulir Tamu Baru</h3>
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Nama Tamu</label>
                <input type="text" id="guestName" class="w-full border rounded py-2 px-3" required>
            </div>
             <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Asal/Instansi</label>
                <input type="text" id="guestOrigin" class="w-full border rounded py-2 px-3" required>
            </div>
             <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Bertemu Dengan (Nama Guru/Staf)</label>
                <input type="text" id="guestMeeting" class="w-full border rounded py-2 px-3" required>
            </div>
             <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Tujuan Kunjungan</label>
                <textarea id="guestPurpose" class="w-full border rounded py-2 px-3" rows="3" required></textarea>
            </div>
            <div class="flex justify-end pt-4">
                <button type="button" id="cancelBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg mr-2">Batal</button>
                <button type="submit" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">Simpan & Check-in</button>
            </div>
        </form>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Elemen DOM ---
        const dateFilter = document.getElementById('date-filter');
        const guestTableBody = document.getElementById('guestTableBody');
        const modal = document.getElementById('addGuestModal');
        const addGuestBtn = document.getElementById('addGuestBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const addGuestForm = document.getElementById('addGuestForm');

        const LOCAL_STORAGE_KEY = 'schoolGuestLog';
        let guestLog = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || [];

        const saveToLocalStorage = () => localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(guestLog));
        
        const getStatusBadge = (status) => {
            const styles = {
                'Masih di Lokasi': 'bg-blue-100 text-blue-800',
                'Sudah Keluar': 'bg-gray-100 text-gray-800',
            };
            return `<span class="px-2 py-1 text-xs font-medium rounded-full ${styles[status] || ''}">${status}</span>`;
        };

        const renderGuestTable = (selectedDate) => {
            guestTableBody.innerHTML = '';
            const dailyGuests = guestLog.filter(g => g.tanggal === selectedDate).sort((a,b) => b.id - a.id); // Show newest first
            
            if (dailyGuests.length === 0) {
                 guestTableBody.innerHTML = `<tr><td colspan="7" class="text-center py-6 text-gray-500">Belum ada tamu pada tanggal ini.</td></tr>`;
                 return;
            }

            dailyGuests.forEach(guest => {
                const checkoutButton = guest.status === 'Masih di Lokasi'
                    ? `<button onclick="handleCheckout('${guest.id}')" class="bg-green-500 text-white text-xs font-bold py-1 px-3 rounded-full hover:bg-green-600">Check-out</button>`
                    : `<span class="text-gray-400">Selesai</span>`;
                
                const row = `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-bold text-gray-900">${guest.waktuMasuk}</td>
                        <td class="px-6 py-4 font-medium text-gray-800">${guest.nama}<p class="font-normal text-gray-500">${guest.instansi}</p></td>
                        <td class="px-6 py-4">${guest.bertemu}</td>
                        <td class="px-6 py-4">${guest.tujuan}</td>
                        <td class="px-6 py-4 font-bold text-gray-900">${guest.waktuKeluar || '-'}</td>
                        <td class="px-6 py-4">${getStatusBadge(guest.status)}</td>
                        <td class="px-6 py-4 text-center">${checkoutButton}</td>
                    </tr>`;
                guestTableBody.innerHTML += row;
            });
        };

        const renderStatCards = (selectedDate) => {
            const dailyGuests = guestLog.filter(g => g.tanggal === selectedDate);
            document.getElementById('statTotal').textContent = dailyGuests.length;
            document.getElementById('statCurrent').textContent = dailyGuests.filter(g => g.status === 'Masih di Lokasi').length;
        };

        const renderAll = (date) => {
            renderGuestTable(date);
            renderStatCards(date);
        };

        window.handleCheckout = (guestId) => {
            const guestIndex = guestLog.findIndex(g => g.id === guestId);
            if (guestIndex > -1) {
                const now = new Date();
                guestLog[guestIndex].waktuKeluar = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                guestLog[guestIndex].status = 'Sudah Keluar';
                saveToLocalStorage();
                renderAll(dateFilter.value);
            }
        };

        addGuestForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const now = new Date();
            const newGuest = {
                id: `guest_${Date.now()}`,
                tanggal: now.toISOString().slice(0, 10),
                waktuMasuk: now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                nama: document.getElementById('guestName').value,
                instansi: document.getElementById('guestOrigin').value,
                bertemu: document.getElementById('guestMeeting').value,
                tujuan: document.getElementById('guestPurpose').value,
                waktuKeluar: null,
                status: 'Masih di Lokasi'
            };
            guestLog.push(newGuest);
            saveToLocalStorage();
            dateFilter.value = newGuest.tanggal; // Switch view to today if needed
            renderAll(newGuest.tanggal);
            modal.classList.add('hidden');
        });

        const init = () => {
            dateFilter.value = new Date().toISOString().slice(0, 10);
            
            // Initial data if empty
            if (guestLog.length === 0) {
                 const today = dateFilter.value;
                 const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
                 guestLog = [
                     { id: 'guest_1', tanggal: today, waktuMasuk: '09:15', nama: 'Arief Budiman', instansi: 'Dinas Pendidikan', bertemu: 'Dr. Indah Permata, M.Pd.', tujuan: 'Rapat Koordinasi', waktuKeluar: '10:30', status: 'Sudah Keluar' },
                     { id: 'guest_2', tanggal: today, waktuMasuk: '11:00', nama: 'Rina Wati', instansi: 'Orang Tua Murid', bertemu: 'Bambang Subagio, S.Kom.', tujuan: 'Konsultasi nilai anak', waktuKeluar: null, status: 'Masih di Lokasi' },
                     { id: 'guest_3', tanggal: yesterday, waktuMasuk: '13:00', nama: 'CV Percetakan Maju', instansi: 'Vendor', bertemu: 'Bagian TU', tujuan: 'Pengantaran dokumen', waktuKeluar: '13:10', status: 'Sudah Keluar' }
                 ];
                 saveToLocalStorage();
            }

            renderAll(dateFilter.value);
            
            // Event Listeners
            dateFilter.addEventListener('change', () => renderAll(dateFilter.value));
            addGuestBtn.addEventListener('click', () => {
                addGuestForm.reset();
                modal.classList.remove('hidden');
            });
            cancelBtn.addEventListener('click', () => modal.classList.add('hidden'));
            modal.addEventListener('click', (e) => { if(e.target === modal) modal.classList.add('hidden'); });
        };

        init();
    });
    </script>
</body>
</html>
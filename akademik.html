<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Aplikasi Sekolah - Manajemen Akademik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</head>
<body class="bg-gray-100 font-sans">

    <div class="flex h-screen">
        <aside class="w-64 bg-white shadow-md hidden md:block">
            <div class="p-6">
                <h2 class="text-2xl font-bold text-gray-800">App Sekolah</h2>
                <p class="text-sm text-gray-500">Versi 1.0</p>
            </div>
            <nav class="mt-6">
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="grid-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Dashboard</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="people-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">PPDB</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="wallet-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Keuangan</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="checkmark-done-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Absensi Siswa</span>
                </a>
                 <a href="#" class="flex items-center px-6 py-3 bg-blue-500 text-white font-semibold">
                    <ion-icon name="book-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Akademik</span>
                </a>
            </nav>
        </aside>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            <header>
                <h1 class="text-3xl font-bold text-gray-900">Manajemen Nilai Akademik</h1>
                <p class="text-gray-600 mt-1">Input dan kelola nilai siswa per mata pelajaran dengan mudah.</p>
            </header>

            <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h3 class="text-xl font-semibold text-gray-800">Daftar Nilai Siswa</h3>
                    <div class="flex items-center gap-4 w-full md:w-auto">
                        <select id="classSelect" class="border rounded py-2 px-3 text-sm w-full">
                            </select>
                        <select id="subjectSelect" class="border rounded py-2 px-3 text-sm w-full">
                            </select>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 w-1/4">Nama Siswa</th>
                                <th class="px-3 py-3 text-center">Tugas (20%)</th>
                                <th class="px-3 py-3 text-center">Harian (20%)</th>
                                <th class="px-3 py-3 text-center">UTS (30%)</th>
                                <th class="px-3 py-3 text-center">UAS (30%)</th>
                                <th class="px-6 py-3 text-center">Nilai Akhir</th>
                            </tr>
                        </thead>
                        <tbody id="gradeTableBody">
                            </tbody>
                    </table>
                </div>

                <div class="flex justify-end mt-6">
                    <button id="saveGradesBtn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-5 rounded-lg flex items-center">
                        <ion-icon name="save-outline" class="mr-2"></ion-icon>
                        Simpan Semua Perubahan
                    </button>
                </div>
                 <div id="toast" class="fixed bottom-10 right-10 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-300">
                    Perubahan berhasil disimpan!
                </div>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Elemen DOM ---
        const classSelect = document.getElementById('classSelect');
        const subjectSelect = document.getElementById('subjectSelect');
        const gradeTableBody = document.getElementById('gradeTableBody');
        const saveGradesBtn = document.getElementById('saveGradesBtn');
        const toast = document.getElementById('toast');

        // --- Data Master & State Aplikasi ---
        const LOCAL_STORAGE_KEY = 'schoolGrades';
        const MASTER_DATA_SISWA = {
            "10 IPA 1": ["Ahmad Fauzi", "Budi Santoso", "Citra Lestari", "Dewi Anggraini", "Eko Prasetyo"],
            "11 IPS 2": ["Fajar Nugraha", "Gita Permata", "Hadi Wijaya", "Indah Sari", "Joko Susilo"],
        };
        const MASTER_MAPEL = ["Matematika", "Fisika", "Bahasa Indonesia", "Sejarah"];
        const GRADE_WEIGHTS = { tugas: 0.2, harian: 0.2, uts: 0.3, uas: 0.3 };

        // Structure: { "10 IPA 1_Matematika": [ {nama: "Ahmad Fauzi", tugas: 80, ...}, ... ] }
        let allGrades = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || {};
        
        const saveToLocalStorage = () => {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(allGrades));
        };

        const showToast = () => {
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 3000);
        };

        const calculateFinalGrade = (grades) => {
            const { tugas = 0, harian = 0, uts = 0, uas = 0 } = grades;
            const final = (tugas * GRADE_WEIGHTS.tugas) + (harian * GRADE_WEIGHTS.harian) + (uts * GRADE_WEIGHTS.uts) + (uas * GRADE_WEIGHTS.uas);
            return final.toFixed(1);
        };

        const renderGradeTable = () => {
            const selectedClass = classSelect.value;
            const selectedSubject = subjectSelect.value;
            const students = MASTER_DATA_SISWA[selectedClass];
            const storageKey = `${selectedClass}_${selectedSubject}`;
            const currentGrades = allGrades[storageKey] || [];

            gradeTableBody.innerHTML = '';
            if (!students) {
                gradeTableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4">Pilih kelas dan mata pelajaran.</td></tr>`;
                return;
            }

            students.forEach(studentName => {
                const studentGradeData = currentGrades.find(g => g.nama === studentName) || { nama: studentName };
                const finalGrade = calculateFinalGrade(studentGradeData);
                
                const row = `
                    <tr class="bg-white border-b hover:bg-gray-50" data-student-name="${studentName}">
                        <td class="px-6 py-4 font-medium text-gray-900">${studentName}</td>
                        <td class="px-2 py-2"><input type="number" class="w-20 text-center border rounded py-1 grade-input" data-type="tugas" value="${studentGradeData.tugas || ''}" min="0" max="100"></td>
                        <td class="px-2 py-2"><input type="number" class="w-20 text-center border rounded py-1 grade-input" data-type="harian" value="${studentGradeData.harian || ''}" min="0" max="100"></td>
                        <td class="px-2 py-2"><input type="number" class="w-20 text-center border rounded py-1 grade-input" data-type="uts" value="${studentGradeData.uts || ''}" min="0" max="100"></td>
                        <td class="px-2 py-2"><input type="number" class="w-20 text-center border rounded py-1 grade-input" data-type="uas" value="${studentGradeData.uas || ''}" min="0" max="100"></td>
                        <td class="px-6 py-4 text-center font-bold text-lg ${finalGrade >= 75 ? 'text-green-600' : 'text-red-600'} final-grade">${finalGrade}</td>
                    </tr>
                `;
                gradeTableBody.innerHTML += row;
            });
        };
        
        const updateFinalGradeInRow = (rowElement) => {
            const grades = {};
            rowElement.querySelectorAll('.grade-input').forEach(input => {
                grades[input.dataset.type] = parseFloat(input.value) || 0;
            });
            const finalGradeCell = rowElement.querySelector('.final-grade');
            const finalGrade = calculateFinalGrade(grades);
            finalGradeCell.textContent = finalGrade;
            finalGradeCell.className = `px-6 py-4 text-center font-bold text-lg ${finalGrade >= 75 ? 'text-green-600' : 'text-red-600'} final-grade`;
        };
        
        // --- Event Listeners ---
        classSelect.addEventListener('change', renderGradeTable);
        subjectSelect.addEventListener('change', renderGradeTable);

        saveGradesBtn.addEventListener('click', () => {
            const selectedClass = classSelect.value;
            const selectedSubject = subjectSelect.value;
            const storageKey = `${selectedClass}_${selectedSubject}`;
            const newGradesForSubject = [];

            gradeTableBody.querySelectorAll('tr').forEach(row => {
                const studentName = row.dataset.studentName;
                if(studentName) {
                    const studentData = { nama: studentName };
                    row.querySelectorAll('.grade-input').forEach(input => {
                        const value = input.value;
                        if(value) { // Hanya simpan jika ada nilai
                           studentData[input.dataset.type] = parseFloat(value);
                        }
                    });
                    newGradesForSubject.push(studentData);
                }
            });

            allGrades[storageKey] = newGradesForSubject;
            saveToLocalStorage();
            showToast();
        });

        // Event delegation untuk update nilai akhir secara real-time
        gradeTableBody.addEventListener('input', (e) => {
            if (e.target.classList.contains('grade-input')) {
                const row = e.target.closest('tr');
                updateFinalGradeInRow(row);
            }
        });

        // --- Inisialisasi Aplikasi ---
        const init = () => {
            // Isi dropdown kelas
            classSelect.innerHTML = '<option value="">-- Pilih Kelas --</option>';
            Object.keys(MASTER_DATA_SISWA).forEach(className => {
                classSelect.innerHTML += `<option value="${className}">${className}</option>`;
            });
            // Isi dropdown mata pelajaran
            subjectSelect.innerHTML = '<option value="">-- Pilih Mapel --</option>';
            MASTER_MAPEL.forEach(mapel => {
                subjectSelect.innerHTML += `<option value="${mapel}">${mapel}</option>`;
            });
            
            // Tampilkan pesan awal
             gradeTableBody.innerHTML = `<tr><td colspan="6" class="text-center py-10 text-gray-500">Silakan pilih kelas dan mata pelajaran untuk mulai mengelola nilai.</td></tr>`;
        };

        init();
    });
    </script>
</body>
</html>
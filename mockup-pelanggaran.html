<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Aplikasi Sekolah - Manajemen Pelanggaran</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <style>
        /* Sedikit custom style untuk transisi modal */
        .modal {
            transition: opacity 0.25s ease;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="flex h-screen">
        <aside class="w-64 bg-white shadow-md hidden md:block">
            <div class="p-6">
                <h2 class="text-2xl font-bold text-gray-800">App Sekolah</h2>
                <p class="text-sm text-gray-500">Versi 1.0</p>
            </div>
            <nav class="mt-6">
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="grid-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Dashboard</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="people-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">PPDB</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="wallet-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Keuangan</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="checkmark-done-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Absensi Siswa</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 bg-blue-500 text-white font-semibold">
                    <ion-icon name="alert-circle-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Pelanggaran</span>
                </a>
                 <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="book-outline" class="w-5 h-5"></ion-icon>
                    <span class="mx-4">Akademik</span>
                </a>
            </nav>
        </aside>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            <header>
                <h1 class="text-3xl font-bold text-gray-900">Manajemen Pelanggaran Siswa</h1>
                <p class="text-gray-600 mt-1">Catat, lihat, dan kelola semua data pelanggaran siswa secara terpusat.</p>
            </header>

            <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Daftar Pelanggaran</h3>
                    <button id="addViolationBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg flex items-center">
                        <ion-icon name="add-outline" class="mr-2"></ion-icon>
                        Tambah Data
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3">Nama Siswa</th>
                                <th scope="col" class="px-6 py-3">Kelas</th>
                                <th scope="col" class="px-6 py-3">Jenis Pelanggaran</th>
                                <th scope="col" class="px-6 py-3">Poin</th>
                                <th scope="col" class="px-6 py-3">Tanggal</th>
                                <th scope="col" class="px-6 py-3">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="violationTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <div id="violationModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
            <h3 id="modalTitle" class="text-2xl font-bold mb-4">Tambah Pelanggaran Baru</h3>
            <form id="violationForm">
                <input type="hidden" id="violationId">
                
                <div class="mb-4">
                    <label for="studentName" class="block text-gray-700 text-sm font-bold mb-2">Nama Siswa:</label>
                    <input type="text" id="studentName" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                
                <div class="mb-4">
                    <label for="studentClass" class="block text-gray-700 text-sm font-bold mb-2">Kelas:</label>
                    <input type="text" id="studentClass" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>

                <div class="mb-4">
                    <label for="violationType" class="block text-gray-700 text-sm font-bold mb-2">Jenis Pelanggaran:</label>
                    <input type="text" id="violationType" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="points" class="block text-gray-700 text-sm font-bold mb-2">Poin:</label>
                        <input type="number" id="points" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                     <div>
                        <label for="date" class="block text-gray-700 text-sm font-bold mb-2">Tanggal:</label>
                        <input type="date" id="date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                </div>

                <div class="flex items-center justify-end">
                    <button type="button" id="cancelBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg mr-2">Batal</button>
                    <button type="submit" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elemen DOM ---
            const addViolationBtn = document.getElementById('addViolationBtn');
            const modal = document.getElementById('violationModal');
            const cancelBtn = document.getElementById('cancelBtn');
            const violationForm = document.getElementById('violationForm');
            const tableBody = document.getElementById('violationTableBody');
            const modalTitle = document.getElementById('modalTitle');
            const violationIdInput = document.getElementById('violationId');

            // --- State Aplikasi ---
            const LOCAL_STORAGE_KEY = 'schoolViolations';
            let violations = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || [];

            // --- Fungsi CRUD ---

            // READ: Menampilkan data ke tabel
            const renderTable = () => {
                tableBody.innerHTML = '';
                if (violations.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4 px-6 text-gray-500">Belum ada data pelanggaran.</td></tr>`;
                    return;
                }
                violations.forEach(v => {
                    const row = `
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${v.name}</td>
                            <td class="px-6 py-4">${v.class}</td>
                            <td class="px-6 py-4">${v.type}</td>
                            <td class="px-6 py-4">${v.points}</td>
                            <td class="px-6 py-4">${v.date}</td>
                            <td class="px-6 py-4 flex items-center space-x-2">
                                <button onclick="handleEdit('${v.id}')" class="text-blue-600 hover:text-blue-900 font-medium">Edit</button>
                                <button onclick="handleDelete('${v.id}')" class="text-red-600 hover:text-red-900 font-medium">Hapus</button>
                            </td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });
            };

            // Menyimpan data ke Local Storage
            const saveToLocalStorage = () => {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(violations));
            };

            // CREATE & UPDATE: Logika saat form disubmit
            violationForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = {
                    id: violationIdInput.value || Date.now().toString(),
                    name: document.getElementById('studentName').value,
                    class: document.getElementById('studentClass').value,
                    type: document.getElementById('violationType').value,
                    points: document.getElementById('points').value,
                    date: document.getElementById('date').value,
                };

                if (violationIdInput.value) { // Jika ada ID, berarti ini mode UPDATE
                    const index = violations.findIndex(v => v.id === formData.id);
                    violations[index] = formData;
                } else { // Jika tidak ada ID, berarti mode CREATE
                    violations.push(formData);
                }
                
                saveToLocalStorage();
                renderTable();
                closeModal();
            });

            // --- Fungsi Helper ---
            const openModalForCreate = () => {
                violationForm.reset();
                violationIdInput.value = '';
                modalTitle.textContent = 'Tambah Pelanggaran Baru';
                // Set tanggal hari ini sebagai default
                document.getElementById('date').valueAsDate = new Date();
                modal.classList.remove('hidden');
            };

            const openModalForEdit = (id) => {
                const violation = violations.find(v => v.id === id);
                if (!violation) return;

                modalTitle.textContent = 'Edit Data Pelanggaran';
                violationIdInput.value = violation.id;
                document.getElementById('studentName').value = violation.name;
                document.getElementById('studentClass').value = violation.class;
                document.getElementById('violationType').value = violation.type;
                document.getElementById('points').value = violation.points;
                document.getElementById('date').value = violation.date;

                modal.classList.remove('hidden');
            };

            const closeModal = () => {
                modal.classList.add('hidden');
            };
            
            // --- Event Handlers Global (untuk tombol Edit/Delete) ---
            window.handleEdit = (id) => {
                openModalForEdit(id);
            };

            // DELETE
            window.handleDelete = (id) => {
                if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                    violations = violations.filter(v => v.id !== id);
                    saveToLocalStorage();
                    renderTable();
                }
            };
            
            // --- Event Listeners ---
            addViolationBtn.addEventListener('click', openModalForCreate);
            cancelBtn.addEventListener('click', closeModal);
            // Menutup modal jika klik di luar area form
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // --- Inisialisasi Aplikasi ---
            // Tambahkan data contoh jika local storage kosong
            if (violations.length === 0) {
                violations = [
                    {id: '1', name: 'Budi Santoso', class: '10 IPA 1', type: 'Terlambat masuk sekolah', points: '5', date: '2025-08-20'},
                    {id: '2', name: 'Ani Lestari', class: '11 IPS 2', type: 'Seragam tidak lengkap', points: '10', date: '2025-08-22'},
                ];
                saveToLocalStorage();
            }
            renderTable();
        });
    </script>
</body>
</html>
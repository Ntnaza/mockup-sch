<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Pegawai - Aplikasi Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <style>
        .sidebar-link.active { background-color: #3b82f6; color: white; font-weight: 600; }
        .toast { transition: opacity 0.3s ease, transform 0.3s ease; }
        /* Style untuk radio button custom */
        .radio-label {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }
        input[type="radio"]:checked + .radio-label {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex h-screen">
        <div id="sidebar-placeholder"></div>
        
        <main class="flex-1 overflow-y-auto p-6 md:p-10">
            <header>
                <h1 class="text-3xl font-bold text-gray-900">Absensi Pegawai</h1>
                <p class="text-gray-600 mt-1">Catat kehadiran pegawai harian.</p>
            </header>
            
            <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
                <!-- Kontrol Tanggal & Tombol Simpan -->
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 border-b pb-6">
                    <div class="flex items-center gap-2">
                        <label for="tanggalAbsen" class="font-semibold text-gray-700">Tanggal Absensi:</label>
                        <input type="date" id="tanggalAbsen" class="border rounded-lg py-2 px-3 text-sm">
                    </div>
                    <button id="saveBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg flex items-center text-sm w-full md:w-auto justify-center">
                        <ion-icon name="save-outline" class="mr-2"></ion-icon>Simpan Absensi
                    </button>
                </div>

                <!-- Tabel Absensi -->
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 w-10">No</th>
                                <th class="px-6 py-3">Nama Pegawai</th>
                                <th class="px-6 py-3 text-center">Kehadiran</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Data absensi akan dimuat di sini -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <div id="toast-container" class="fixed bottom-10 right-10 z-50"></div>

    <script src="../assets/app.js" defer></script>
    <script src="../assets/sidebar-sub.js" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const tableBody = document.getElementById('tableBody');
        const tanggalAbsenInput = document.getElementById('tanggalAbsen');
        const saveBtn = document.getElementById('saveBtn');

        const TEACHER_KEY = 'schoolTeachers';
        const ATTENDANCE_KEY = 'schoolTeacherAttendance';

        const teachers = JSON.parse(localStorage.getItem(TEACHER_KEY)) || [];
        let attendanceData = JSON.parse(localStorage.getItem(ATTENDANCE_KEY)) || {};

        const renderTable = (tanggal) => {
            tableBody.innerHTML = '';
            const todaysAttendance = attendanceData[tanggal] || {};

            if (teachers.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="3" class="text-center py-4">Data guru tidak ditemukan. Silakan tambahkan data guru terlebih dahulu.</td></tr>`;
                return;
            }

            teachers.forEach((teacher, index) => {
                const currentStatus = todaysAttendance[teacher.id] || 'Hadir'; // Default ke Hadir
                
                const statuses = ['Hadir', 'Sakit', 'Izin', 'Alpha'];
                const radioButtonsHTML = statuses.map(status => `
                    <div class="inline-block">
                        <input type="radio" name="status-${teacher.id}" id="status-${teacher.id}-${status}" value="${status}" class="hidden" data-id="${teacher.id}" ${currentStatus === status ? 'checked' : ''}>
                        <label for="status-${teacher.id}-${status}" class="radio-label">${status}</label>
                    </div>
                `).join('');

                tableBody.innerHTML += `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 text-center">${index + 1}</td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-900">${teacher.nama}</div>
                            <div class="text-xs text-gray-500">NIP: ${teacher.nip || '-'}</div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex justify-center items-center gap-2 flex-wrap">
                                ${radioButtonsHTML}
                            </div>
                        </td>
                    </tr>
                `;
            });
        };

        saveBtn.addEventListener('click', () => {
            const tanggal = tanggalAbsenInput.value;
            if (!tanggal) {
                App.helpers.showToast('Silakan pilih tanggal terlebih dahulu!', 'error');
                return;
            }

            let newAttendanceForDay = {};
            const checkedRadios = document.querySelectorAll('input[type="radio"]:checked');
            
            checkedRadios.forEach(radio => {
                const teacherId = radio.dataset.id;
                const status = radio.value;
                newAttendanceForDay[teacherId] = status;
            });

            attendanceData[tanggal] = newAttendanceForDay;
            localStorage.setItem(ATTENDANCE_KEY, JSON.stringify(attendanceData));
            App.helpers.showToast(`Absensi untuk tanggal ${tanggal} berhasil disimpan!`);
        });

        tanggalAbsenInput.addEventListener('change', () => {
            renderTable(tanggalAbsenInput.value);
        });

        // Inisialisasi halaman
        const today = new Date().toISOString().slice(0, 10);
        tanggalAbsenInput.value = today;
        renderTable(today);
    });
    </script>
</body>
</html>

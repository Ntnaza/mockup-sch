<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Aplikasi Sekolah - Absensi Guru</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <style> .modal { transition: opacity 0.25s ease; } </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="flex h-screen">
        <aside class="w-64 bg-white shadow-md hidden md:block">
            <div class="p-6"><h2 class="text-2xl font-bold text-gray-800">App Sekolah</h2><p class="text-sm text-gray-500">Versi 1.0</p></div>
            <nav class="mt-6">
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="grid-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Dashboard</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="people-outline" class="w-5 h-5"></ion-icon><span class="mx-4">PPDB</span>
                </a>
                 <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="wallet-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Keuangan</span>
                </a>
                 <a href="#" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200">
                    <ion-icon name="book-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Akademik</span>
                </a>
                <a href="#" class="flex items-center px-6 py-3 bg-blue-500 text-white font-semibold">
                    <ion-icon name="finger-print-outline" class="w-5 h-5"></ion-icon><span class="mx-4">Absensi Guru</span>
                </a>
            </nav>
        </aside>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            <header class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Manajemen Absensi Guru & Staf</h1>
                    <p class="text-gray-600 mt-1">Pantau kehadiran harian dan kelola pengajuan izin/cuti.</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <label for="date-filter" class="text-sm font-medium text-gray-700">Tampilkan data untuk tanggal:</label>
                    <input type="date" id="date-filter" class="border rounded-lg p-2 mt-1 w-full md:w-auto">
                </div>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                <div class="bg-white p-6 rounded-lg shadow-lg"><p class="text-gray-500">Total Staf</p><p id="statTotal" class="text-3xl font-bold text-gray-900">0</p></div>
                <div class="bg-white p-6 rounded-lg shadow-lg"><p class="text-gray-500">Hadir Hari Ini</p><p id="statHadir" class="text-3xl font-bold text-green-600">0</p></div>
                <div class="bg-white p-6 rounded-lg shadow-lg"><p class="text-gray-500">Tidak Hadir</p><p id="statTidakHadir" class="text-3xl font-bold text-red-600">0</p></div>
            </div>

            <div class="mt-8">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <a href="#" id="tab-rekap" class="border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Rekap Harian</a>
                        <a href="#" id="tab-izin" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Pengajuan Izin/Cuti (<span id="izin-count">0</span>)</a>
                    </nav>
                </div>

                <div id="content-rekap" class="mt-6 bg-white p-6 rounded-lg shadow-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3">Nama Guru/Staf</th>
                                    <th class="px-6 py-3">Jam Masuk</th>
                                    <th class="px-6 py-3">Jam Pulang</th>
                                    <th class="px-6 py-3">Durasi</th>
                                    <th class="px-6 py-3">Status</th>
                                    <th class="px-6 py-3">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="rekapTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="content-izin" class="mt-6 bg-white p-6 rounded-lg shadow-lg hidden">
                     <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3">Nama Guru/Staf</th>
                                    <th class="px-6 py-3">Jenis Izin</th>
                                    <th class="px-6 py-3">Tanggal</th>
                                    <th class="px-6 py-3">Keterangan</th>
                                    <th class="px-6 py-3">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="izinTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div id="editModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <form id="editForm" class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
            <h3 class="text-xl font-bold mb-4">Edit Data Absensi</h3>
            <p class="mb-4 text-gray-600" id="editModalInfo"></p>
            <input type="hidden" id="editTeacherId">
            <input type="hidden" id="editDate">
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Status Kehadiran</label>
                <select id="editStatus" class="w-full border rounded py-2 px-3"></select>
            </div>
            <div id="jamContainer" class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Jam Masuk</label>
                    <input type="time" id="editJamMasuk" class="w-full border rounded py-2 px-3">
                </div>
                 <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Jam Pulang</label>
                    <input type="time" id="editJamPulang" class="w-full border rounded py-2 px-3">
                </div>
            </div>
            <div class="flex justify-end">
                <button type="button" id="cancelBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg mr-2">Batal</button>
                <button type="submit" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">Simpan</button>
            </div>
        </form>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Elemen DOM ---
        const dateFilter = document.getElementById('date-filter');
        const rekapTableBody = document.getElementById('rekapTableBody');
        const izinTableBody = document.getElementById('izinTableBody');
        const modal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        
        // --- Data Master & State ---
        const MASTER_GURU = [
            { id: 'G01', nama: 'Dr. Indah Permata, M.Pd.', nip: '1975...' },
            { id: 'G02', nama: 'Bambang Subagio, S.Kom.', nip: '1980...' },
            { id: 'G03', nama: 'Siti Nurhaliza, S.Pd.', nip: '1985...' },
            { id: 'G04', nama: 'Agus Wijayanto, S.S.', nip: '1990...' },
        ];
        const STATUS_KEHADIRAN = ['Hadir', 'Sakit', 'Izin', 'Cuti', 'Alpha'];
        let attendanceData = JSON.parse(localStorage.getItem('teacherAttendance')) || [];
        let leaveRequests = JSON.parse(localStorage.getItem('teacherLeaveRequests')) || [];

        const saveAttendance = () => localStorage.setItem('teacherAttendance', JSON.stringify(attendanceData));
        const saveLeaveRequests = () => localStorage.setItem('teacherLeaveRequests', JSON.stringify(leaveRequests));

        const getStatusBadge = (status) => {
            const styles = { 'Hadir': 'bg-green-100 text-green-800', 'Sakit': 'bg-yellow-100 text-yellow-800', 'Izin': 'bg-blue-100 text-blue-800', 'Cuti': 'bg-purple-100 text-purple-800', 'Alpha': 'bg-red-100 text-red-800' };
            return `<span class="px-2 py-1 text-xs font-medium rounded-full ${styles[status] || ''}">${status}</span>`;
        };

        const calculateDuration = (start, end) => {
            if (!start || !end) return '-';
            const startTime = new Date(`1970-01-01T${start}:00`);
            const endTime = new Date(`1970-01-01T${end}:00`);
            let diff = (endTime.getTime() - startTime.getTime()) / 1000 / 60; // difference in minutes
            if (diff < 0) return '-';
            const hours = Math.floor(diff / 60);
            const minutes = diff % 60;
            return `${hours} jam ${minutes} mnt`;
        };

        const renderDailyRecap = (selectedDate) => {
            rekapTableBody.innerHTML = '';
            let hadirCount = 0;

            MASTER_GURU.forEach(guru => {
                let record = attendanceData.find(a => a.teacherId === guru.id && a.tanggal === selectedDate);
                // Check if on leave
                const onLeave = leaveRequests.find(l => l.teacherId === guru.id && l.status === 'Disetujui' && selectedDate >= l.tanggalMulai && selectedDate <= l.tanggalSelesai);
                
                if (onLeave && !record) {
                    record = { status: onLeave.jenis };
                }

                const status = record ? record.status : 'Alpha';
                const jamMasuk = record && record.jamMasuk ? record.jamMasuk : '-';
                const jamPulang = record && record.jamPulang ? record.jamPulang : '-';
                
                if (status === 'Hadir') hadirCount++;

                const row = `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium text-gray-900">${guru.nama}</td>
                        <td class="px-6 py-4">${jamMasuk}</td>
                        <td class="px-6 py-4">${jamPulang}</td>
                        <td class="px-6 py-4">${calculateDuration(jamMasuk, jamPulang)}</td>
                        <td class="px-6 py-4">${getStatusBadge(status)}</td>
                        <td class="px-6 py-4">
                            <button onclick="openEditModal('${guru.id}', '${guru.nama}', '${selectedDate}')" class="font-medium text-blue-600 hover:underline">Edit</button>
                        </td>
                    </tr>`;
                rekapTableBody.innerHTML += row;
            });
            // Update stats
            document.getElementById('statTotal').textContent = MASTER_GURU.length;
            document.getElementById('statHadir').textContent = hadirCount;
            document.getElementById('statTidakHadir').textContent = MASTER_GURU.length - hadirCount;
        };

        const renderLeaveRequests = () => {
            izinTableBody.innerHTML = '';
            const pendingRequests = leaveRequests.filter(r => r.status === 'Pending');
            document.getElementById('izin-count').textContent = pendingRequests.length;
            if (pendingRequests.length === 0) {
                 izinTableBody.innerHTML = `<tr><td colspan="5" class="text-center py-6 text-gray-500">Tidak ada pengajuan izin/cuti baru.</td></tr>`;
                 return;
            }
            pendingRequests.forEach(req => {
                const row = `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium text-gray-900">${req.teacherName}</td>
                        <td class="px-6 py-4">${req.jenis}</td>
                        <td class="px-6 py-4">${req.tanggalMulai} s/d ${req.tanggalSelesai}</td>
                        <td class="px-6 py-4">${req.keterangan}</td>
                        <td class="px-6 py-4 flex items-center space-x-2">
                            <button onclick="handleLeaveApproval('${req.id}', 'Ditolak')" class="bg-red-100 text-red-700 text-xs font-bold py-1 px-3 rounded-full hover:bg-red-200">Tolak</button>
                            <button onclick="handleLeaveApproval('${req.id}', 'Disetujui')" class="bg-green-100 text-green-700 text-xs font-bold py-1 px-3 rounded-full hover:bg-green-200">Setujui</button>
                        </td>
                    </tr>`;
                izinTableBody.innerHTML += row;
            });
        };

        window.openEditModal = (teacherId, teacherName, date) => {
            const record = attendanceData.find(a => a.teacherId === teacherId && a.tanggal === date) || {};
            document.getElementById('editModalInfo').textContent = `${teacherName} - ${date}`;
            document.getElementById('editTeacherId').value = teacherId;
            document.getElementById('editDate').value = date;
            
            const statusSelect = document.getElementById('editStatus');
            statusSelect.innerHTML = STATUS_KEHADIRAN.map(s => `<option value="${s}" ${s === (record.status || 'Alpha') ? 'selected' : ''}>${s}</option>`).join('');
            
            document.getElementById('editJamMasuk').value = record.jamMasuk || '';
            document.getElementById('editJamPulang').value = record.jamPulang || '';
            
            toggleJamContainer(statusSelect.value);
            modal.classList.remove('hidden');
        };

        const toggleJamContainer = (status) => {
            document.getElementById('jamContainer').style.display = status === 'Hadir' ? 'grid' : 'none';
        };
        
        document.getElementById('editStatus').addEventListener('change', (e) => toggleJamContainer(e.target.value));
        
        editForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const teacherId = document.getElementById('editTeacherId').value;
            const date = document.getElementById('editDate').value;
            const status = document.getElementById('editStatus').value;
            
            let record = attendanceData.find(a => a.teacherId === teacherId && a.tanggal === date);
            if (!record) {
                record = { id: `att_${Date.now()}`, teacherId, tanggal: date };
                attendanceData.push(record);
            }
            record.status = status;
            record.jamMasuk = document.getElementById('editJamMasuk').value;
            record.jamPulang = document.getElementById('editJamPulang').value;

            saveAttendance();
            renderDailyRecap(dateFilter.value);
            modal.classList.add('hidden');
        });

        window.handleLeaveApproval = (reqId, action) => {
            if (!confirm(`Anda yakin ingin ${action === 'Disetujui' ? 'menyetujui' : 'menolak'} pengajuan ini?`)) return;
            const reqIndex = leaveRequests.findIndex(r => r.id === reqId);
            leaveRequests[reqIndex].status = action;
            saveLeaveRequests();
            renderLeaveRequests();
        };

        const init = () => {
            // Set date to today
            dateFilter.value = new Date().toISOString().slice(0, 10);
            
            // Initial data if empty
            if (attendanceData.length === 0 && leaveRequests.length === 0) {
                 attendanceData = [
                    { id: 'att1', teacherId: 'G01', tanggal: dateFilter.value, jamMasuk: '07:10', jamPulang: '15:25', status: 'Hadir'},
                    { id: 'att2', teacherId: 'G02', tanggal: dateFilter.value, jamMasuk: '07:15', jamPulang: '15:30', status: 'Hadir'},
                    { id: 'att3', teacherId: 'G03', tanggal: dateFilter.value, status: 'Sakit'}
                 ];
                 leaveRequests = [
                     { id: 'leave1', teacherId: 'G04', teacherName: 'Agus Wijayanto, S.S.', jenis: 'Izin Penting', tanggalMulai: '2025-08-25', tanggalSelesai: '2025-08-25', keterangan: 'Acara keluarga.', status: 'Pending' }
                 ];
                 saveAttendance();
                 saveLeaveRequests();
            }

            // Render all
            renderDailyRecap(dateFilter.value);
            renderLeaveRequests();

            // Event Listeners
            dateFilter.addEventListener('change', () => renderDailyRecap(dateFilter.value));
            document.getElementById('cancelBtn').addEventListener('click', () => modal.classList.add('hidden'));

            // Tab functionality
            const tabRekap = document.getElementById('tab-rekap');
            const tabIzin = document.getElementById('tab-izin');
            const contentRekap = document.getElementById('content-rekap');
            const contentIzin = document.getElementById('content-izin');

            tabRekap.addEventListener('click', (e) => {
                e.preventDefault();
                tabRekap.className = 'border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm';
                tabIzin.className = 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm';
                contentRekap.classList.remove('hidden');
                contentIzin.classList.add('hidden');
            });
             tabIzin.addEventListener('click', (e) => {
                e.preventDefault();
                tabIzin.className = 'border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm';
                tabRekap.className = 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm';
                contentIzin.classList.remove('hidden');
                contentRekap.classList.add('hidden');
            });
        };

        init();
    });
    </script>
</body>
</html>